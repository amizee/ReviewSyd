{% extends "hf.html" %}
{% block title %}Find a Tutor{% endblock %}
{% block content %}
{% load static %}

<div class="font-weight-bold h1 pb-3 text-center">Find a tutor</div>

    <!-- Include the Bootstrap JS library -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<style>

.tutor-description {
  max-width: 100%; /* Set to 100% to allow it to take up full width */
  word-wrap: break-word; /* Allows breaking words if they exceed container's width */
  overflow: hidden; /* Hide the scrollbar */
}

.card {
  overflow: hidden;
}

.card:hover {
  overflow-y: auto;
}

.card:hover::-webkit-scrollbar {
  width: 10px;
}

.card:hover::-webkit-scrollbar-thumb {
  background-color: lightgrey;
}

</style>

<div class="container">
    <div class="row my-4">
        <div class="col-md-5 mx-auto">
            <input type="text" class="form-control" id="search" placeholder="Search for tutors..." onkeyup="searchFunction()">
        </div>
        <!-- Add Button -->
        <div class="col-md-1">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTutorModal" style="white-space: nowrap; padding: 10px 15px; margin-left: -130px;">Post an Ad</button>
        </div>
    </div>

    <!-- Tutors List -->
    <div class="row gy-4 justify-content-center" id="tutorsList" style="margin-bottom: 175px;"> <!-- Added justify-content-center for centering -->
        <!-- Displayed when no results are found -->
        <div id="noResults" style="display: none;" class="text-center mt-4">
            <h4>No related tutor found.</h4>
        </div>
        <!-- Loop to generate tutors from database -->
        {% for tutor in tutors %}
        <div class="col-md-5 tutor">
          <!-- remove button -->

          {% if request.user == tutor.user %}
              <!-- Remove Button -->
              <form method="post" action="{% url 'remove_tutor' tutor.id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger btn-sm">Remove</button>
              </form>
          {% endif %}
          
          <div class="card" style="height: 300px;">
            {% if tutor.image %}
                <img src="{{ tutor.image.url }}" alt="Profile Image" style="width: 70px; height: 70px; margin-right: 80px; margin-left: 18px; margin-top: 18px;">
            {% else %}
                <img src="{% static 'images/default_profile.png' %}" alt="Profile Image" style="width: 70px; height: 70px; margin-right: 80px; margin-left: 18px; margin-top: 18px;">
            {% endif %}
            <div class="card-body">
              <h5 class="name card-title">Name: {{ tutor.name }}</h5>
              <p class="subject card-text">Subject: {{ tutor.subject }}</p>
              <p class="card-text">Email: {{ tutor.email }}</p>
              <p class="tutor-description card-text">Description:<br> 
                {% if tutor.description %}
                    {{ tutor.description }}
                {% else %}
                    Tutor left nothing here.
                {% endif %}
              </p>
            </div>
          </div>
        </div>
        {% endfor %}
    </div>

    <script>
    // This function is called when the user types in the search bar.
    function searchFunction() {
        // Declaring variables for input, filter, tutors, tutor, name, subject, i, and txtValue.
        let input, filter, tutors, tutor, name, subject, i, txtValue;
        let found = false; // Variable to track if a matching resume is found.
        input = document.getElementById('search');
        filter = input.value.toUpperCase();
        tutors = document.getElementsByClassName('tutor');
        // Looping through each tutor.
        for (i = 0; i < tutors.length; i++) {
            tutor = tutors[i];
            name = tutor.getElementsByClassName('name')[0];
            subject = tutor.getElementsByClassName('subject')[0];
            txtValue = name.textContent || name.innerText;
            txtValue += subject.textContent || subject.innerText;
            // Checking if the text from the name and subject matches the search filter.
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                // If a match is found, the tutor is displayed and found is set to true.
                tutors[i].style.display = "";
                found = true;
            } else {
                // If no match is found, the tutor is not displayed.
                tutors[i].style.display = "none";
            }
        }
        // If no matches are found after looping through all tutors, display a no results found message.
        if (!found) {
            document.getElementById('noResults').style.display = 'block';
        } else {
            document.getElementById('noResults').style.display = 'none';
        }
    }
    </script>

    <!-- Modal -->
    <div class="modal fade" id="addTutorModal" tabindex="-1" aria-labelledby="addTutorModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addTutorModalLabel">Add Tutor Information</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>


          <div class="modal-body">
            <form method="post" action="/add_tutor/" enctype="multipart/form-data">
              {% csrf_token %}
              <div class="mb-3">
                <label for="name" class="form-label">Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
              </div>
              <div class="mb-3">
                <label for="subject" class="form-label">Subject</label>
                <input type="text" class="form-control" id="subject" name="subject" required>
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" required>
              </div>
              <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3"></textarea>
              </div>
              <div class="mb-3">
                <label for="image" class="form-label">Profile Image</label>
                <input type="file" class="form-control" id="image" name="image">
              </div>
              <button type="submit" class="btn btn-primary">Add Tutor</button>
            </form>
          </div>
        </div>
      </div>
    </div>

</div>
{% endblock %}


